<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>‚òÅÔ∏è Supabase Cloud File Upload</title>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    // üîë Your Supabase project details
    const SUPABASE_URL = "https://kqcvixdtdzvfrijcfvyx.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxY3ZpeGR0ZHp2ZnJpamNmdnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4OTU1NDgsImV4cCI6MjA3NzQ3MTU0OH0.rQozBqIErszWOAFGJEpUjO7xdSUqu7uQMB8YuWxYe8s";

    // Initialize Supabase client
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const bucketName = "uploads"; // ‚úÖ Must match your bucket exactly

    document.addEventListener("DOMContentLoaded", () => {
      const uploadInput = document.getElementById("fileUpload");
      const status = document.getElementById("status");
      const preview = document.getElementById("preview");

      uploadInput.addEventListener("change", async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        status.textContent = "‚è≥ Uploading...";

        try {
          // Upload the file (replace if already exists)
          const { error } = await supabase.storage
            .from(bucketName)
            .upload(file.name, file, { upsert: true });

          if (error) throw error;

          // Construct public URL manually (always works for public buckets)
          const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/${bucketName}/${file.name}`;

          // Display success message and preview
          status.innerHTML = `‚úÖ Uploaded successfully!<br>
            <a href="${publicUrl}" target="_blank">${publicUrl}</a>`;

          preview.innerHTML = `<h3>Preview:</h3>
            <img src="${publicUrl}" alt="Uploaded Image" style="max-width:300px;margin-top:10px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.2);" />`;
        } catch (err) {
          status.textContent = "‚ùå Upload failed: " + err.message;
        }
      });
    });
  </script>
</head>
<body style="font-family: Poppins, Arial; text-align: center; margin-top: 60px;">
  <h1>‚òÅÔ∏è Cloud File Upload using Supabase</h1>
  <p>Upload an image and get a shareable public link instantly!</p>
  <input type="file" id="fileUpload" accept="image/*" />
  <p id="status" style="margin-top:20px; font-weight:600;"></p>
  <div id="preview" style="margin-top:20px;"></div>
</body>
</html>
